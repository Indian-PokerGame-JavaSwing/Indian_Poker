import javax.swing.*;
import java.awt.*;
import java.io.File;

public class IndianPokerFrame extends JFrame {

    private final IndianPokerEngine engine;
    private CardImageLoader imageLoader;


    // UI ì»´í¬ë„ŒíŠ¸
    private FlipCard lblHumanCard;
    private FlipCard lblAICard;
    private JLabel lblPot;
    private JLabel lblInfo;
    private JLabel lblMoney;
    private JLabel lblTitle;

    private JButton btnBet;
    private JButton btnFold;
    private JButton btnNext;
    
    

    public IndianPokerFrame() {
        this.engine = new IndianPokerEngine("You", 200);

        // â­ ì¹´ë“œ ì´ë¯¸ì§€ ê²½ë¡œ ì„¤ì • (ë°©ë²• 2: íŒŒì¼ ê²½ë¡œ)
        // í”„ë¡œì íŠ¸ ë£¨íŠ¸ ê¸°ì¤€: /src/cardimg/ ì•ˆì— ì´ë¯¸ì§€ê°€ ìˆì„ ë•Œ
        String baseDir = System.getProperty("user.dir") + "/src/cardimg/";
        imageLoader = new CardImageLoader(baseDir, 150, 220);

        setTitle("Indian Poker");
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setSize(820, 620);
        setLocationRelativeTo(null);

        initUI();
        engine.startNewRound();
        refreshUI();

        setVisible(true);
    }


    private void initUI() {
        JPanel main = new JPanel(new BorderLayout());
        main.setBackground(new Color(245, 245, 245));
        setContentPane(main);

        // ===== TOP : Title =====
        lblTitle = new JLabel("INDIAN POKER", SwingConstants.CENTER);
        lblTitle.setFont(new Font("ë§‘ì€ ê³ ë”•", Font.BOLD, 26));
        lblTitle.setBorder(BorderFactory.createEmptyBorder(10, 0, 10, 0));
        main.add(lblTitle, BorderLayout.NORTH);

        // ===== CENTER =====
        JPanel centerWrapper = new JPanel(new BorderLayout());
        centerWrapper.setOpaque(false);
        main.add(centerWrapper, BorderLayout.CENTER);

        // --- Left Player Panel ---
        JPanel leftPanel = new JPanel(null);
        leftPanel.setPreferredSize(new Dimension(200, 400));
        leftPanel.setOpaque(false);

        JLabel p1Name = new JLabel("Player1", SwingConstants.CENTER);
        p1Name.setFont(new Font("ë§‘ì€ ê³ ë”•", Font.BOLD, 16));
        p1Name.setBounds(0, 10, 200, 30);
        leftPanel.add(p1Name);

        JLabel p1Image = new JLabel("ğŸ¤–", SwingConstants.CENTER);
        p1Image.setBounds(25, 60, 150, 120);
        p1Image.setFont(new Font("ë§‘ì€ ê³ ë”•", Font.PLAIN, 60));
        leftPanel.add(p1Image);

        lblHumanCard = new FlipCard(null, imageLoader.getBackImage());
        lblHumanCard.setOpaque(true);
        lblHumanCard.setBackground(Color.WHITE);
        lblHumanCard.setBorder(BorderFactory.createLineBorder(Color.DARK_GRAY));
        lblHumanCard.setBounds(25, 200, 150, 220);
        lblHumanCard.setFont(new Font("ë§‘ì€ ê³ ë”•", Font.BOLD, 28));
        leftPanel.add(lblHumanCard);

        centerWrapper.add(leftPanel, BorderLayout.WEST);

        // --- Right Player Panel ---
        JPanel rightPanel = new JPanel(null);
        rightPanel.setPreferredSize(new Dimension(200, 400));
        rightPanel.setOpaque(false);

        JLabel p2Name = new JLabel("Player2", SwingConstants.CENTER);
        p2Name.setFont(new Font("ë§‘ì€ ê³ ë”•", Font.BOLD, 16));
        p2Name.setBounds(0, 10, 200, 30);
        rightPanel.add(p2Name);

        JLabel p2Image = new JLabel("ğŸ§ ", SwingConstants.CENTER);
        p2Image.setBounds(25, 60, 150, 120);
        p2Image.setFont(new Font("ë§‘ì€ ê³ ë”•", Font.PLAIN, 60));
        rightPanel.add(p2Image);

        lblAICard = new FlipCard(null, imageLoader.getBackImage());
        lblAICard.setOpaque(true);
        lblAICard.setBackground(Color.WHITE);
        lblAICard.setBorder(BorderFactory.createLineBorder(Color.DARK_GRAY));
        lblAICard.setBounds(25, 200, 150, 220);
        lblAICard.setFont(new Font("ë§‘ì€ ê³ ë”•", Font.BOLD, 28));
        rightPanel.add(lblAICard);

        centerWrapper.add(rightPanel, BorderLayout.EAST);

        // --- Center Board Panel (Game Over, Pot) ---
        JPanel board = new JPanel(new GridBagLayout());
        board.setBackground(new Color(255, 255, 200));
        board.setPreferredSize(new Dimension(300, 400));
        board.setBorder(BorderFactory.createLineBorder(Color.BLACK, 3));

        GridBagConstraints gbc = new GridBagConstraints();
        gbc.insets = new Insets(10, 10, 10, 10);
        gbc.gridx = 0;
        gbc.gridy = 0;

        JLabel lblGameText = new JLabel("Game Over", SwingConstants.CENTER);
        lblGameText.setForeground(Color.RED);
        lblGameText.setFont(new Font("ë§‘ì€ ê³ ë”•", Font.BOLD, 32));
        board.add(lblGameText, gbc);

        gbc.gridy++;
        lblPot = new JLabel("POT: 0", SwingConstants.CENTER);
        lblPot.setFont(new Font("ë§‘ì€ ê³ ë”•", Font.BOLD, 18));
        board.add(lblPot, gbc);

        centerWrapper.add(board, BorderLayout.CENTER);

        // ===== BOTTOM =====
        JPanel bottom = new JPanel(new BorderLayout());
        bottom.setBorder(BorderFactory.createEmptyBorder(5, 20, 10, 20));

        lblMoney = new JLabel("", SwingConstants.CENTER);
        lblMoney.setFont(new Font("ë§‘ì€ ê³ ë”•", Font.BOLD, 14));
        bottom.add(lblMoney, BorderLayout.NORTH);

        lblInfo = new JLabel("", SwingConstants.CENTER);
        lblInfo.setOpaque(true);
        lblInfo.setBackground(new Color(230, 230, 230));
        lblInfo.setFont(new Font("ë§‘ì€ ê³ ë”•", Font.PLAIN, 14));
        bottom.add(lblInfo, BorderLayout.CENTER);

        JPanel actionButtons = new JPanel();
        actionButtons.setBorder(BorderFactory.createEmptyBorder(5, 0, 0, 0));

        btnBet = new JButton("ë°°íŒ…");
        btnFold = new JButton("í¬ê¸°");
        btnNext = new JButton("ë‹¤ìŒ ë¼ìš´ë“œ");

        actionButtons.add(btnBet);
        actionButtons.add(btnFold);
        actionButtons.add(btnNext);

        bottom.add(actionButtons, BorderLayout.SOUTH);
        main.add(bottom, BorderLayout.SOUTH);

        // ===== ì´ë²¤íŠ¸ ì—°ê²° =====
        btnBet.addActionListener(e -> {
            engine.playerCall();
            refreshUI();
        });

        btnFold.addActionListener(e -> {
            engine.playerFold();
            refreshUI();
        });

        btnNext.addActionListener(e -> {

            engine.btnNext();  // ê²Œì„ ìƒíƒœ ìƒˆ ë¼ìš´ë“œ ì§„í–‰
            refreshUI();         // UI ì—…ë°ì´íŠ¸

            // ì¹´ë“œ ë‹¤ì‹œ ê°€ë ¤ì£¼ê³  ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰
            lblHumanCard.setFrontImage(imageLoader.getCardImage(engine.getHumanCard()));
            lblHumanCard.setBackImage(imageLoader.getBackImage());
            
            lblHumanCard.flip(); // â­ ë‹¤ì‹œ ë’¤ì§‘íˆëŠ” ì—°ì¶œ ì‹¤í–‰

            // ìƒëŒ€ ì¹´ë“œëŠ” ì´ë²ˆ ë¼ìš´ë“œì—ì„œ ë°”ë¡œ ë³´ì—¬ì•¼ í•¨
            lblAICard.setIcon(imageLoader.getCardImage(engine.getAICard()));

        });

    }

    private void refreshUI() {

        Card humanCard = engine.getHumanCard();
        Card aiCard = engine.getAICard();
        
        

        // ---- ì¹´ë“œ í‘œì‹œ (ì¸ë””ì–¸ í¬ì»¤ ê·œì¹™ ì ìš©) ----
        if (engine.getPhase() == IndianPokerEngine.Phase.BETTING) {
            lblHumanCard.setFrontImage(imageLoader.getCardImage(humanCard));
            lblHumanCard.flip(); // ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰

            lblAICard.setIcon(imageLoader.getCardImage(aiCard)); // ìƒëŒ€ëŠ” ë³´ì„
        } else {
            lblHumanCard.setIcon(imageLoader.getCardImage(humanCard));
            lblAICard.setIcon(imageLoader.getCardImage(aiCard));
        }


        // ---- ìƒíƒœ í…ìŠ¤íŠ¸ ë° ë²„íŠ¼ ì—…ë°ì´íŠ¸ ----
        lblPot.setText("POT: " + engine.getPot());
        lblMoney.setText(String.format("ë‚˜: %dì›   |   AI: %dì›",
                engine.getHuman().getChips(),
                engine.getAI().getChips()));

        lblPot.setText("POT: " + engine.getPot());
        lblInfo.setText(engine.getMessage());

        boolean betting = (engine.getPhase() == IndianPokerEngine.Phase.BETTING);

        btnBet.setEnabled(betting);
        btnFold.setEnabled(betting);
        btnNext.setEnabled(engine.getPhase() == IndianPokerEngine.Phase.SETTLE);
    }



    public static void main(String[] args) {
        SwingUtilities.invokeLater(IndianPokerFrame::new);
        
    }
}
